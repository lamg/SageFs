#!/bin/sh
# Auto-increment patch version in Directory.Build.props on every commit.
# 0.5.53 -> 0.5.54, etc.

PROPS="Directory.Build.props"

# Extract current version
VERSION=$(grep -oP '(?<=<Version>)[^<]+' "$PROPS" 2>/dev/null)
if [ -z "$VERSION" ]; then
  echo "pre-commit: No <Version> found in $PROPS, skipping bump"
  exit 0
fi

# Split into parts and bump patch
MAJOR=$(echo "$VERSION" | cut -d. -f1)
MINOR=$(echo "$VERSION" | cut -d. -f2)
PATCH=$(echo "$VERSION" | cut -d. -f3)
NEW_PATCH=$((PATCH + 1))
NEW_VERSION="$MAJOR.$MINOR.$NEW_PATCH"

sed -i "s|<Version>$VERSION</Version>|<Version>$NEW_VERSION</Version>|" "$PROPS"

git add "$PROPS"

echo "pre-commit: version $VERSION -> $NEW_VERSION"
